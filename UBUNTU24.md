# Ubuntu 24 配置 SmartProxy（默认直连，仅配置的或直连不了的走代理）

## 方式一：PAC 自动配置（推荐）

所有流量经 SmartProxy，由 SmartProxy 按规则决定直连或走代理，并记录访问状态。

### 1. 启动 SmartProxy

```bash
cd smartproxy
python app.py
```

### 2. 设置系统代理

1. 打开 **设置 (Settings) → 网络 (Network) → 代理 (Proxy)**
2. 选择 **「已关闭」** 或 **「手动」** 时，先改为 **「自动」**
3. 在「URL」中填入：
   ```
   http://127.0.0.1:5000/proxy.pac
   ```
4. 保存

### 3. 生效说明

- 所有流量会先到 SmartProxy，用于记录访问并更新状态
- **直连域名**（如百度、淘宝）：SmartProxy 直连目标，不走上游代理
- **代理域名**（如 github.com、openai.com）：SmartProxy 经 SOCKS5 转发
- **未配置域名**：先试直连（约 3 秒），失败再走代理

---

## 方式二：全流量经 SmartProxy（支持「直连不了再走代理」）

所有流量先经过 SmartProxy，由 SmartProxy 决定直连或走代理；对未知域名会先试直连，失败再走代理。

### 1. 设置系统代理

1. 打开 **设置 → 网络 → 代理**
2. 选择 **「手动」**
3. 填写：
   - HTTP 代理：`127.0.0.1`
   - HTTPS 代理：`127.0.0.1`
   - 端口：`8080`
4. 保存

### 2. 生效说明

- **规则为直连**：直接访问
- **规则为代理**：先试直连（3 秒），失败再走 SOCKS5 代理
- **无规则**：先试直连（3 秒），失败再走代理

---

## 图形界面快捷方式（Ubuntu 24）

若在设置里找不到代理：

1. 按 `Super` 键搜索「proxy」或「代理」
2. 或打开 **系统设置 → 网络 → 代理**
3. 在 GNOME 下路径可能是：**设置 → 隐私与安全 → 代理**（视版本而定）

---

## 验证

配置完成后：

1. 访问 https://www.baidu.com → 应能正常打开（直连）
2. 访问 https://github.com → 若能打开，说明代理生效
3. 在 SmartProxy 页面（http://localhost:5000）查看访问记录是否更新
